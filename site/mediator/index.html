<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Mediator - BoltOn</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Mediator";
    var mkdocs_page_input_path = "mediator.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> BoltOn</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Mediator</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#request-response-and-requesthandler">Request, Response and RequestHandler</a></li>
    

    <li class="toctree-l2"><a href="#interceptors">Interceptors</a></li>
    

    <li class="toctree-l2"><a href="#unit-of-work">Unit of Work</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data/">Data</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">BoltOn</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Mediator</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Mediator is the backbone of BoltOn. It follows the <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html">Request/Response</a> and <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/CommandMessage.html">Command Message</a> patterns. It was developed after getting inspired by <a href="https://github.com/davybrion/Agatha">Agatha</a>, <a href="https://github.com/BrighterCommand/Brighter">Brighter</a> and <a href="https://github.com/jbogard/MediatR">MediatR</a>.</p>
<h2 id="request-response-and-requesthandler">Request, Response and RequestHandler</h2>
<p>In order to use Mediator, you need to create a request by implementing any of these interfaces:</p>
<ul>
<li><code>IRequest</code>
<br /> To create a request that doesn't have any response and doesn't require unit of work.</li>
<li><code>IRequest&lt;out TResponse&gt;</code> 
<br /> To create a request with response of type TResponse and doesn't require unit of work.</li>
<li><code>ICommand</code>
<br /> To create a request that doesn't have any response and that requires unit of work. A transaction with isolation level ReadCommitted will be started for the requests that implement this interface. </li>
<li><code>ICommand&lt;out TResponse&gt;</code> 
<br /> To create a request with response of type TResponse and that requires require unit of work. A transaction with isolation level ReadCommitted will be started for the requests that implement this interface.</li>
<li><code>IQuery&lt;out TResponse&gt;</code>
<br /> To create a request with response of type TResponse and that requires unit of work. A transaction with isolation level ReadCommitted will be started for the requests that implement this interface. 
<br /> If <strong>BoltOn.Mediator.Data.EF</strong> is installed and bolted, DbContexts' ChangeTracker.QueryTrackingBehavior will be set to <code>QueryTrackingBehavior.NoTracking</code> and ChangeTracker.AutoDetectChangesEnabled will be set to false.</li>
<li><code>IStaleQuery&lt;out TResponse&gt;</code> 
<br /> To create a request with response of type TResponse and that requires require unit of work. A transaction with isolation level ReadUncommitted will be started for the requests that implement this interface.</li>
</ul>
<p>The response can be a value or a reference type, which is always tied to the request.</p>
<p>After declaring the request and the response, you need to create a handler by implementiong any of these interfaces:</p>
<ul>
<li><code>IRequestHandler&lt;in TRequest&gt;</code> or <code>IRequestAsyncHandler&lt;in TRequest&gt;</code>
<br> For handlers that do not return any response.</li>
<li><code>IRequestHandler&lt;in TRequest, TResponse&gt;</code> or <code>IRequestAsyncHandler&lt;in TRequest, TResponse&gt;</code>
<br> For handlers that have responses.</li>
</ul>
<p><strong>Note:</strong> <code>MediatorRegistrationTask</code> takes care of registering the handers to the DI framework.</p>
<h2 id="interceptors">Interceptors</h2>
<p>Every request flows thru a set of built-in interceptors, which can be controlled by implementing appropriate marker interfaces. </p>
<ul>
<li>
<p><code>StopwatchInterceptor</code>
<br> This interceptor logs the time that a request enters and exits the pipeline. This interceptor is enabled only if the request implements <code>IEnableStopwatchInterceptor</code> interface.</p>
</li>
<li>
<p><code>UnitOfWorkInterceptor</code>
<br> This interceptor starts a transaction with an isolation level based on the interface like IQuery or ICommand etc., (mentioned above) that the request implements. This interceptor is enabled only if the request implements <code>IEnableUnitOfWorkInterceptor</code></p>
</li>
</ul>
<p>You can create an interceptor by implementing <code>IInterceptor</code> interface. If you want to enable or disable an interceptor based on a marker interface implementation, you can inherit <code>BaseRequestSpecificInterceptor&lt;T&gt;</code></p>
<p>Interceptors can be added and removed using the extension methods <code>AddInterceptor&lt;TInterceptor&gt;</code> and <code>RemoveInterceptor&lt;TInterceptor&gt;</code> (in BoltOn.Mediator namespace) respectively. All the interceptors can be removed using the extension method <code>RemoveAllInterceptors</code>.</p>
<h2 id="unit-of-work">Unit of Work</h2>
<p>If you're using Mediator, you need not worry about starting or committing an unit of work, it will be done automatically using <code>UnitOfWorkInterceptor</code>. In case if you're not using Mediator or you want to take control on starting an unit of work, use <code>IUnitOfWorkManager</code>. It takes care of starting a new transaction with <code>System.Transactions.TransactionScopeOption.RequiresNew</code> if there is one already started. </p>
<p><strong>Note:</strong> Though it's possible to start an unit of work manually, please try to do avoid it, especially when there is already one, as having more than one unit of work isn't a proper way to build applications. This will be useful only when you want to query a database with an isolation level different from the one started by <code>UnitOfWorkInterceptor</code>.</p>
<p>In case if you want to change the default transaction isolation level for all the requests or only certain requests, or if you want to change the TransactionTimeout, you can implement <code>IUnitOfWorkOptionsBuilder</code> or inherit <code>UnitOfWorkOptionsBuilder</code> and override Build method.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data/" class="btn btn-neutral float-right" title="Data">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../data/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
